<% content_for :grid_container_class do %>narrow<% end %>
<% content_for :head do %>
  <script type="application/ld+json">
    <%=
      {
        "@context": "http://schema.org",
        "@type": "Article",
        "headline": @post.full_title,
        "description": @post.meta_description,
        "datePublished": @post.posted_at&.strftime("%Y-%m-%d"),
        "dateModified": @post.updated_at&.strftime("%Y-%m-%d"),
        "keywords": @post.tags.map(&:name).join(', '),
        "mainEntityOfPage": canonical_href,
        "url": canonical_href,
        "author": {
          "@type": "Person",
          "familyName": "Viklund",
          "givenName": "Daniel",
          "name": "Daniel Viklund",
          "alternateName": "DanneManne",
          "sameAs": [
            "https://twitter.com/dannemanne84",
            "https://www.linkedin.com/in/daniel-viklund-83231793/",
            "https://github.com/dannemanne",
            "https://stackoverflow.com/users/511558/dannemanne",
            "https://dev.to/dannemanne",
            "https://www.buymeacoffee.com/dannemanne",
          ],
        },
      }.to_json.html_safe
    %>
  </script>
  <style type="text/css">
    h1,h2,h3,h4 {
      margin-top: 2rem;
    }
    code {
      padding: 0 2px;
    }
  </style>
<% end %>

<article>
  <header>
    <% if @post.cover.attached? %>
      <div style="margin-bottom: 2rem; position: relative; width: 100%; height: 0; overflow: hidden; padding-top: <%= "%d" % (@post.cover.blob.metadata[:height].to_d / @post.cover.blob.metadata[:width] * 100) %>%">
        <%= image_tag @post.cover, style: 'width: 100%; position: absolute; top: 0; left: 0;' %>
      </div>
    <% end %>
    <% title @post.full_title %>
    <h1>
      <% if @post.series_title.present? %>
        <small><%= @post.display_series %></small><br/>
      <% end %>
      <%= @post.title %>
    </h1>
    <% description @post.meta_description %>

    <p style="color: rgb(169,169,169); margin-bottom: 3px;">
      <%= @post.posted_at.strftime("%b %e, %Y") %>
      <% if can? :update, @post %>
        - <%= link_to "Edit", edit_post_path(@post) %>
      <% end %>
    </p>
  </header>

  <section data-parse="once"><%= @post.body %></section>

  <footer>
    <div class="grid-x grid-padding-x">
      <div class="cell text-right">
        <% if @post.tags.any? %>
          Tags:
          <% @post.tags.each_with_index do |tag, i| %><% if i != 0 %>,<% end %>
            <%= link_to tag_path(tag), :class => "postTag", :title => "View posts tagged with #{tag.name}", :rel => "tag" do %>
              <span class="postTagText"><%= tag.name %></span><% end %><% end %>
        <% end %>
      </div>
    </div>
    <div class="clear"></div>

    <% if @post.allow_comments %>
      <% if Rails.env.production? %>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = 'dannemanne'; // required: replace example with your forum shortname

          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      <% end %>
    <% end %>

    <% if @post.newer_post %>
      <span style="float: left;"><%= link_to "< #{@post.newer_post.title_preview}", post_path(@post.newer_post), :rel => "next", :title => "View the next post: #{@post.newer_post.title}" %></span>
    <% end %>
    <% if @post.older_post %>
      <span style="float: right;"><%= link_to "#{@post.older_post.title_preview} >", post_path(@post.older_post), :rel => "prev", :title => "View the previous post: #{@post.older_post.title}" %></span>
    <% end %>
    <div class="clear"></div>
  </footer>
</article>
