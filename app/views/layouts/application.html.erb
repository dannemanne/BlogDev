<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width" />
  <title>DanneManne.com</title>
  <link rel="pingback" href="/xmlrpc" />
  <link rel="shortcut icon" href="/images/favicon.ico">
  <%= javascript_include_tag :defaults %>
  <%= javascript_include_tag "http://ajax.aspnetcdn.com/ajax/jquery.templates/beta1/jquery.tmpl.min.js" %>
  <%= javascript_include_tag "google-code-prettify/prettify.js" %>
  <%= stylesheet_link_tag "/javascripts/google-code-prettify/prettify.css" %>
  <%= javascript_include_tag "showdown/showdown.js" %>
  <%= javascript_include_tag "wysiwym/wysiwym.js" %>
  <%= stylesheet_link_tag "/javascripts/wysiwym/wysiwym.css" %>
  <%= stylesheet_link_tag :all %>

  <script type="text/javascript">
    // For the Live Preview we want to check the value of
    // textarea changes as some set interval.  If it's
    // changed, we'll call Showdown to convert the textarea
    // input to HTML then prettify to colorize code blocks.
    var showdown = new Showdown.converter();
    var prev_text = "";
    var update_live_preview = function(node, preview) {
        var input_text = node.val(); //$('#post_body')
        if (input_text != prev_text) {
            var text = $("<div>"+ showdown.makeHtml(input_text) +"</div>");
            text.find('pre').addClass('prettyprint linenums');
            text.find('p code').addClass('prettyprint');
            text.find('pre').each(function() {
                $(this).html(prettyPrintOne($(this).html(), undefined, true));
            });
            text.find('p code').each(function() {
                $(this).html(prettyPrintOne($(this).html()));
            });
            preview.html(text); //$('#post_body_preview')
            prev_text = input_text;
        }
    };
    var parse_preview = function(node){
        var text = $("<div>"+ node.html() +"</div>");
        text.find('pre').addClass('prettyprint linenums');
        text.find('p code').addClass('prettyprint');
        text.find('pre').each(function() {
            $(this).html(prettyPrintOne($(this).html(), undefined, true));
        });
        text.find('p code').each(function() {
            $(this).html(prettyPrintOne($(this).html()));
        });
        node.html(text);
    };
  </script>

  <%= csrf_meta_tag %>

  <% if Rails.env.production? %>
    <%= render "partials/google_analytics" %>
  <% end %>
</head>
<body>

<div id="container">
  <div id="header-top">
    <div class="container_12">
      <div class="grid_12">
        <% if user_signed_in? %>
          <p>Logged in as <%= current_user.display_name %>. <%= link_to "Logout", destroy_user_session_path, :title => "Logout user #{current_user.display_name}" %></p>
        <% else %>
          <p><%= link_to "Login", new_user_session_path, :title => "Login to DanneManne.com" %></p>
        <% end %>
      </div>
    </div>
  </div>

  <header class="body-header">
    <div class="container_12">

      <div class="grid_2">
        <%= link_to image_tag("/images/logo.png", :class => "header-logo"), root_path %>
      </div>

      <div class="grid_8">
        <%= image_tag "/images/header.png" %>
      </div>

      <div class="grid_2">&nbsp;</div>

      <div class="clear"></div>
    </div>
  </header>

  <div id="content">

    <div id="main" class="container_12">

      <div id="left_side" class="grid_2">
        <section>
          <h2>LATEST POSTS</h2>
          <% recent_posts.each do |post| %>
            <p><%= link_to post.title, post_path(post), :title => "View post: #{post.title}" %></p>
          <% end %>
          <p style="padding-top: 15px;"><%= link_to "View more Posts", posts_path, :title => "View more Posts" %></p>
        </section>

        <section>
          <h2>PROJECTS</h2>
          <p><%= link_to "View all Projects", projects_path, :title => "View all Projects" %></p>
        </section>
      </div>

      <div id="workspace" class="grid_8">
        <div style="padding: 0 10px;">
          <%= yield %>
        </div>
      </div>

      <div id="right_side" class="grid_2">
        <section>
          <h2>ARCHIVE</h2>
          <% archive_months.each do |date| %>
            <p><%= link_to Date.new(*date.split("-").map(&:to_i)).strftime("%B %Y"), archive_path(Date.new(*date.split("-").map(&:to_i)).year, Date.new(*date.split("-").map(&:to_i)).month > 9 ? Date.new(*date.split("-").map(&:to_i)).month : "0#{Date.new(*date.split("-").map(&:to_i)).month}"), :title => "View posts made in #{date}" %></p>
          <% end %>
          <p style="padding-top: 15px;"><%= link_to "View more Posts", posts_path, :title => "View more Posts" %></p>
        </section>

        <section>
          <h2>POPULAR TAGS</h2>
          <% popular_tags.each do |tag| %>
            <p><%= link_to tag.name, tag_path(tag), :title => "List all Posts tagged by #{tag.name}", :rel => "tag" %></p>
          <% end %>
          <p style="padding-top: 15px;"><%= link_to "View more Tags", tags_path, :title => "View more Tags" %></p>
        </section>

        <% if user_signed_in? %>
          <section>
            <h2>TOOLS</h2>
            <% if can? :create, Post %>
              <%= content_tag :p, link_to("New Post", new_post_path) %>
              <% if current_user.posts.drafts.any? %>
                <%= content_tag :p, link_to("Drafts (#{current_user.posts.drafts.count})", drafts_path) %>
              <% end %>
            <% end %>
          </section>
        <% end %>
      </div>

      <div class="clear"></div>

    </div>

  </div>

  <footer>

    <div class="container_12">

      <div class="grid_3">
        <p>Copyright Â© <%= DateTime.now.year %></p>
      </div>
      <div class="grid_3">
        <p>&nbsp;</p>
      </div>
      <div class="grid_3">
        <p>&nbsp;</p>
      </div>
      <div class="grid_3">
        <p><%= link_to 'info@dannemanne.com', 'mailto:info@dannemanne.com' %></p>
      </div>
      <div class="clear"></div>
    </div>

  </footer>

</div>

</body>
</html>
